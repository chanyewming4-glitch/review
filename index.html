<script>
    // 1. 改用 window.location，確保手機權限正常
    const urlParams = new URLSearchParams(window.location.search);
    const review = urlParams.get('msg'); 
    
    if (review) {
        document.getElementById('text').innerText = decodeURIComponent(review);
    }

    async function copyAndGo() {
        const content = document.getElementById('text').innerText;
        const googleMapUrl = "https://search.google.com/local/writereview?placeid=ChIJEQQ2CQs7aTQRAMzchRtCKqU";

        try {
            // 嘗試執行複製
            await navigator.clipboard.writeText(content);
            alert('評論已複製！即將開啟地圖，請直接在評論區「貼上」。');
            // 複製成功後直接跳轉
            window.location.href = googleMapUrl;
        } catch (err) {
            // 針對舊款手機或 LINE 內建瀏覽器的相容方案
            const textArea = document.createElement("textarea");
            textArea.value = content;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            window.location.href = googleMapUrl;
        }
    }
</script>
